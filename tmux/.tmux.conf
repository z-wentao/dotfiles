# ══════════════════════════════════════
# 基础环境
# ══════════════════════════════════════
set -g default-terminal "tmux-256color"
set -as terminal-overrides ",*:RGB"
set -s escape-time 0
set -s extended-keys on
set -sg repeat-time 300
set -s focus-events on
set -g mouse on
set -g history-limit 10000
set -g detach-on-destroy off
set -g status-interval 5
set-hook -g client-session-changed 'refresh-client -S'

# ══════════════════════════════════════
# 编号
# ══════════════════════════════════════
set -g base-index 1
setw -g pane-base-index 1
setw -g automatic-rename on
set -g renumber-windows on

# ══════════════════════════════════════
# Prefix
# ══════════════════════════════════════
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# ══════════════════════════════════════
# 基础操作
# ══════════════════════════════════════
bind b last-window

# Ctrl+1/2/3 切换 session（按列表顺序）
bind -n C-1 run "tmux switch-client -t $(tmux list-sessions -F '##S' | sed -n 1p)"
bind -n C-2 run "tmux switch-client -t $(tmux list-sessions -F '##S' | sed -n 2p)"
bind -n C-3 run "tmux switch-client -t $(tmux list-sessions -F '##S' | sed -n 3p)"
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"
bind . command-prompt -p "Rename session:" "rename-session '%%'"
bind , command-prompt -p "Rename window:" "rename-window '%%'"

# ══════════════════════════════════════
# 分屏（当前目录）
# ══════════════════════════════════════
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# ══════════════════════════════════════
# Pane 导航（vim 风格）
# ══════════════════════════════════════
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R

# ══════════════════════════════════════
# Pane 大小调整
# ══════════════════════════════════════
bind -r H resize-pane -L 3
bind -r J resize-pane -D 3
bind -r K resize-pane -U 3
bind -r L resize-pane -R 3

# ══════════════════════════════════════
# Copy Mode（vi 风格）
# ══════════════════════════════════════
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode MouseDown1Pane send-keys -X cancel

# ══════════════════════════════════════
# 外观
# ══════════════════════════════════════

# 调色板（Kanagawa 风格）
# bg:      #1F1F28
# sumiInk: #2A2A37
# fujiGray:#727169
# oldWhite:#C8C093
# sakura:  #D27E99
# wave:    #7E9CD8

set -g status-position bottom
set -g status-style "bg=#1F1F28"

# ── 左侧：所有 session ──
set -g status-left-length 80
set -g status-left "#{S:#[#{?session_attached,fg=#1F1F28 bg=#7E9CD8 bold,fg=#C8C093 bg=#2A2A37 nobold}] #S #[bg=#1F1F28] }#[fg=#727169] │ "

# ── 右侧：日期时间 ──
set -g status-right-length 50
set -g status-right "#[fg=#2A2A37]#[fg=#C8C093,bg=#2A2A37]  %m/%d #[fg=#7E9CD8,bg=#2A2A37]#[fg=#1F1F28,bg=#7E9CD8,bold]  %H:%M "

# ── Window 列表 ──
setw -g window-status-format "#[fg=#727169]  #I #W "
setw -g window-status-current-format "#[fg=#D27E99,bg=#2A2A37,bold]  #I #W #[fg=#2A2A37,bg=#1F1F28]"
setw -g window-status-separator ""

# ── Pane 边框 ──
set -g pane-border-style "fg=#2A2A37"
set -g pane-active-border-style "fg=#7E9CD8"
set -g pane-border-lines heavy

# ── 消息 & 命令行 ──
set -g message-style "fg=#C8C093,bg=#2A2A37"
set -g message-command-style "fg=#D27E99,bg=#2A2A37"

# ── 选择模式 ──
set -g mode-style "fg=#1F1F28,bg=#D27E99"

# ══════════════════════════════════════
# 插件
# ══════════════════════════════════════
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @sessionx-bind 'o'
set -g @sessionx-window-mode 'on'
set -g @sessionx-filter-current 'false'

# TPM 初始化（必须放最后一行）
run '~/.tmux/plugins/tpm/tpm'
